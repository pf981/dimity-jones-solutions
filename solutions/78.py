import collections
import re

import decrypter


text = """They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter twice". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter twice". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter twice". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They backtracked. "This is so stupid," Leland moaned. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter twice with a space in between". They backtracked. They took the door straight ahead marked "Write this letter twice with a space in between". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter twice". They backtracked. They took the door to the left marked "Write this letter twice". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter twice". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter twice". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter then start a new line". They backtracked. They took the door to the left marked "Write this letter then start a new line". They took the door to the right marked "Write this letter capitalized". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. "I hate this goddamn stupid labyrinth!" cried Leland. They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a period then skip a line". They backtracked. They took the door straight ahead marked "Write this letter followed by a period then skip a line". They took the door to the left marked "Write this letter capitalized". They backtracked. They took the door to the left marked "Write this letter capitalized". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter capitalized". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter twice followed by a space". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter twice followed by a space". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter twice followed by a space". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. Leland groaned, "We're just going in circles!" They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter twice". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a colon then start a new line". They took the door to the right marked "Write this letter capitalized". They backtracked. They backtracked. They took the door to the left marked "Write this letter followed by a colon then start a new line". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They took the door straight ahead marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by a colon then start a new line". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a colon then start a new line". They backtracked. They took the door to the right marked "Write this letter followed by a colon then start a new line". They took the door to the left marked "Write this letter capitalized". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter twice with a space in between". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter twice with a space in between". They backtracked. They took the door straight ahead marked "Write this letter twice with a space in between". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They took the door to the right marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter twice". They backtracked. They took the door to the right marked "Write this letter twice". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter twice". They took the door to the right marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They took the door straight ahead marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter twice". They took the door to the right marked "Write this letter". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter twice". They backtracked. They took the door to the right marked "Write this letter twice". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter twice followed by a semicolon then start a new line". They took the door to the right marked "Write this letter capitalized". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They backtracked. "I want my mom," Leland grunted. They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They backtracked. They took the door to the left marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by a comma and a space". They backtracked. They took the door to the right marked "Write this letter followed by a comma and a space". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a comma and a space". They backtracked. They took the door to the right marked "Write this letter followed by a comma and a space". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a comma and a space". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They took the door to the left marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter twice". They backtracked. They took the door to the right marked "Write this letter twice". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter twice followed by a space". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. "I'm tired," murmured Leland. They backtracked. They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter followed by a comma then start a new line". They took the door straight ahead marked "Write this letter capitalized". They backtracked. They took the door to the left marked "Write this letter capitalized". They took the door to the left marked "Write this letter twice". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter twice with a space in between". They backtracked. They took the door to the right marked "Write this letter twice with a space in between". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. "Dimity, I can't go on," said Leland. They backtracked. "Sure you can," said Dimity. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They backtracked. They took the door straight ahead marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter twice with a space in between". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter twice with a space in between". They took the door to the left marked "Write this letter followed by a space". They backtracked. They took the door straight ahead marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter twice followed by a comma then skip a line". They backtracked. They took the door to the left marked "Write this letter twice followed by a comma then skip a line". They took the door straight ahead marked "Write this letter capitalized". They backtracked. They took the door to the right marked "Write this letter capitalized". They backtracked. They took the door straight ahead marked "Write this letter capitalized". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a semicolon and a space". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. Leland clutched his head by the ears and screamed wordlessly. They took the door straight ahead marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They took the door to the left marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter twice". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter twice". They took the door straight ahead marked "Write this letter then start a new line". They took the door straight ahead marked "Write this letter capitalized". They backtracked. They took the door to the left marked "Write this letter capitalized". They backtracked. "Let's rest awhile," Leland pleaded. They took the door straight ahead marked "Write this letter capitalized". "No," said Dimity. They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter twice". They took the door to the left marked "Write this letter then start a new line". They backtracked. They backtracked. They took the door to the left marked "Write this letter twice". They took the door to the right marked "Write this letter then start a new line". They took the door straight ahead marked "Write this letter capitalized". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter twice". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter twice". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. "I want to die," mouthed Leland voicelessly. They backtracked. "I really want to die." They took the door to the right marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They backtracked. They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter followed by a space". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter twice". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They took the door to the right marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter twice with a space in between". They backtracked. They took the door straight ahead marked "Write this letter twice with a space in between". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter twice". They took the door to the left marked "Write this letter followed by a comma then start a new line". They took the door to the left marked "Write this letter capitalized". They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter twice with a space in between". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter twice". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. "Is this hell?" asked Leland. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter twice". They took the door to the left marked "Write this letter followed by a comma then start a new line". They took the door to the right marked "Write this letter capitalized". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter followed by a comma then start a new line". They took the door straight ahead marked "Write this letter capitalized". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter twice". They backtracked. They took the door to the left marked "Write this letter twice". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a space". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter followed by a comma and a space". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a comma and a space". They took the door straight ahead marked "Write this letter". They backtracked. "This IS hell," said Leland. They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a space". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door straight ahead marked "Write this letter followed by a comma and a space". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They backtracked. They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by a comma and a space". They took the door to the left marked "Write this letter". "We're already dead and this is hell." They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter". They took the door to the left marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter followed by a space". They took the door straight ahead marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the right marked "Write this letter". They took the door to the right marked "Write this letter". They took the door straight ahead marked "Write this letter". They took the door straight ahead marked "Write this letter followed by an exclamation mark". They backtracked. They backtracked. "Dimity, please!" They took the door to the right marked "Write this letter". They backtracked. They backtracked. They took the door straight ahead marked "Write this letter". They backtracked. They took the door to the left marked "Write this letter". They took the door to the left marked "Write this letter". They took the door to the right marked "Write this letter followed by an exclamation mark"."""


actions = []

# "How to Write a Poem"
# "Start somewhere; Write this letter capitalized"
actions.append(("S", "L"))

# Straight and right say "Write this letter."
actions.append(("R", "l"))
#    Haven't handled F

# The room it led to had one other door in the opposite wall, marked "Write this letter"; they opened and passed through it
actions.append(("F", "l"))

# -- then immediately returned, for the room it led to had no other exits.
actions.append(("B", ""))

#  They had no choice but to backtrack again, straight ahead, through the second door they'd passed through, which on this side was marked "Start somewhere; Write this letter capitalized". They passed through it, back to the first room, which Dimity now thought of as the "Start somewhere" room.
#    They backtracked could mean 180 then straight? But there are multiple backtracks in a row
"""


Their choices were either to backtrack through the very first door, now on their left (which was marked, sure enough, on this side, "How to Write a Poem"), or to continue through the other door marked "Write this letter", now on their right. They went right.

In this next room, there were doors to the left and straight ahead marked "Write this letter followed by a space." They took the door straight ahead. The only option from the next room was a door to the right marked "Write this letter"; they took it. Now there were doors to the left, straight ahead, and to the right, marked "Write this letter". They took the door to the left. From the next room, they took the only door, to the left, marked "Write this letter twice". But the room they entered was a dead end. They backtracked, and (now to the right) backtracked again.

Leland pointed to the door on the right marked "Write this letter followed by a space". "That's the one we came through, right?"

"Right," said Dimity. "Correct."

But she was not as sure as she could wish to be. So she began taking notes.

They took the door straight ahead marked "Write this letter". But the next room was a dead end. They turned around and backtracked. They took the door to the right marked "Write this letter". Dead end! They backtracked. Again they backtracked -- taking the door, now straight ahead, that Leland had pointed at, for all the others, they knew, were dead ends. And they backtracked again. They took the door to the right marked "Write this letter followed by a space"."""


def parse_sentence(sentence: str) -> tuple[str, str] | None:
    if sentence == "They backtracked":
        return ("B", "")

    elif match := re.match(
        'They took the door (.+) marked "Write this letter ?(.*)"', sentence
    ):
        direction = {"straight ahead": "F", "to the left": "L", "to the right": "R"}[
            match.group(1)
        ]
        writes = {
            "": "l",
            "capitalized": "L",
            "followed by a colon then start a new line": "l:\n",
            "followed by a comma and a space": "l, ",
            "followed by a comma then start a new line": "l,\n",
            "followed by a period then skip a line": "l.\n\n",
            "followed by a semicolon and a space": "l; ",
            "followed by a space": "l ",
            "followed by an exclamation mark": "l!",
            "then start a new line": "l\n",
            "twice": "ll",
            "twice followed by a comma then skip a line": "ll,\n\n",
            "twice followed by a semicolon then start a new line": "ll;\n",
            "twice followed by a space": "ll ",
            "twice with a space in between": "l l",
        }[match.group(2)]

        return (direction, writes)

    else:
        # print(f"Ignoring {sentence!r}")
        return None


# collections.Counter(text.split())
# counts = collections.Counter(
#     [sentence.strip() for sentence in re.split(r'[.!]"? ', text)]
# )
# for sentence in counts:
#     print(parse_sentence(sentence))


@decrypter.decrypter(chapter=77)
def decrypt(cipher: str) -> str:
    return decrypter.vigenere_cipher(cipher, "")
